<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Lars Bartsch" />


<title>Little Big Data mit R Desktop</title>

<script src="site_libs/jquery/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap/css/sandstone.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap/shim/respond.min.js"></script>
<script src="site_libs/jqueryui/jquery-ui.min.js"></script>
<link href="site_libs/tocify/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify/jquery.tocify.js"></script>
<script src="site_libs/navigation/tabsets.js"></script>
<script src="site_libs/navigation/codefolding.js"></script>
<link href="site_libs/font-awesome/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome/css/v4-shims.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

.sourceCode .row {
  width: 100%;
}
.sourceCode {
  overflow-x: auto;
}
.code-folding-btn {
  margin-right: -30px;
}
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 61px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h2 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h3 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h4 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h5 {
  padding-top: 66px;
  margin-top: -66px;
}
.section h6 {
  padding-top: 66px;
  margin-top: -66px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>



<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Lars Bartsch</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-fort-awesome"></span>
     
    Basis
  </a>
</li>
<li>
  <a href="about.html">
    <span class="fa fa-child"></span>
     
    Über
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-terminal"></span>
     
    R zählmalwas
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">R schaffen</li>
    <li>
      <a href="nutzungsbericht.html">TEST</a>
    </li>
    <li>
      <a href="Rbigdata.html">2018-04-01 Little Big Data mit R</a>
    </li>
    <li>
      <a href="wordcloud.html">2018-03-15 Word Cloud</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">R lernen @coursera</li>
    <li>
      <a href="pga_rr.html">2018-03-04 NOAA Storm Database</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/kundex">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://www.xing.com/profile/Lars_Bartsch7">
    <span class="fa fa-xing"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Little Big Data mit R Desktop</h1>
<h4 class="author">Lars Bartsch</h4>
<h4 class="date">03. Oktober 2018</h4>

</div>


<div id="grenzbestimmung" class="section level1">
<h1>Grenzbestimmung</h1>
<p><strong>Big Data</strong> — oder <strong>Neue digitale Daten</strong>, wie es in der deutschen amtlichen Statistik heißt — sind nicht erst seit heute in vieler Munde. Große Datenmengen in diesem Sinne bedeuten eine immense Hochskalierung von Speichern, Methoden und Werkzeugen gegenüber “traditionellen” Datenmengen. Nun beschäftige ich mich hier nicht mit neueren Big Data-Frameworks oder Cloud Computing, sondern eher mit kleinskaligen, “normalen” R-Geschichten. Mich interessiert also, wo so ungefähr die Grenze verläuft — von Big Data für “normale” Nutzer, die sich mit R und Statistik beschäftigen.</p>
<p>Im <em>normalen</em> Desktop-Gebrauch von R mit RStudio, d. h. ohne Client-Server-Architektur oder Cloud Computing, werden alle Prozesse im Hautspeicher (RAM) erledigt. Alle Importdaten, R-Objekte, sowie die für die Ergebnisse benötigten Rechenkapazitäten nehmen als <code>R Environments</code> diesen Hauptspeicher ein. Doch dieser ist auch bei modernen Rechnern begrenzt.</p>
<p>Ich arbeite mit einem recht modernen, trotzdem handelsüblichen Laptop:</p>
<ul>
<li>Ubuntu-Betriebssystem 64 bit</li>
<li>Intel i7-6700HQ mit 2,60GHz</li>
<li>16 GByte RAM</li>
<li>schnelle SSD-Festplatte</li>
</ul>
<p>Eins vorweg: Wie sich schon aus dem Gesagten ergibt, ist der RAM das ausschlaggebende Nadelöhr. Die vorgestellten Ergebnisse lassen sich wahrscheinlich allein mit diesem Einflussfaktor linear hochrechnen.</p>
<hr />
</div>
<div id="datenbeschaffung" class="section level1">
<h1>Datenbeschaffung</h1>
<p>Zunächst benötigen wir eine “Big Open Data”-Quelle. Im deutschsprachigem Raum gar nicht so einfach. Ohne langes Suchen nutze ich eine Quelle der American Statistical Association (ASA), die große offene Daten zu <a href="http://stat-computing.org/dataexpo/2009/the-data.html">Airline On-Time Statistics and Delay Causes</a> bereitstellt. In der Kurzbeschreibung heißt es:</p>
<blockquote>
<p>The data consists of flight arrival and departure details for all commercial flights within the USA, from October 1987 to April 2008. This is a large dataset: there are nearly 120 million records in total, and takes up 1.6 gigabytes of space compressed and 12 gigabytes when uncompressed.</p>
</blockquote>
<p>Es handelt sich also um Daten zu <strong>allen (!)</strong> kommerziellen US-amerikanischen Inlandflügen in gut 20 Jahren. Aufgrund dieser Masse beschränken wir uns auf einen Ausschnitt von 2003 bis 2008, also einen Zeitraum von sechs Jahren (…ja, ich habe es mit allen versucht…).</p>
<p>Die Daten sind bz2-komprimiert nach Jahren verfügbar (Kompressionsfaktor: ~6) und werden mit dem folgenden R-Code beschafft. Das Gesamtvolumen beträgt ca. 0,67 GByte (komprimiert) bzw. ca. 4,00 GByte (Rohdaten). Um unnötige Downloads zu vermeiden, wird grundsätzlich mit <code>file.exists</code> geprüft, ob benötigte Eingangsdateien in dem zugewiesenen Unterordner <code>daten</code> bereits vorhanden sind. Fehlende Dateien werden anschließend heruntergeladen.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2003</span><span class="op">:</span><span class="dv">2008</span>){</a>
<a class="sourceLine" id="cb1-2" title="2">  <span class="cf">if</span>(<span class="op">!</span><span class="kw">file.exists</span>(<span class="kw">paste</span>(<span class="st">&quot;daten/&quot;</span>,i,<span class="st">&quot;.csv.bz2&quot;</span>,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))){</a>
<a class="sourceLine" id="cb1-3" title="3">    url &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;http://stat-computing.org/dataexpo/2009/&quot;</span>,i,<span class="st">&quot;.csv.bz2&quot;</span>, <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb1-4" title="4">    <span class="kw">download.file</span>(url, <span class="dt">destfile =</span> <span class="kw">paste</span>(<span class="st">&quot;daten/&quot;</span>,i,<span class="st">&quot;.csv.bz2&quot;</span>,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))</a>
<a class="sourceLine" id="cb1-5" title="5">    }</a>
<a class="sourceLine" id="cb1-6" title="6">}</a></code></pre></div>
<p>Die Dateigröße gibt uns eine erste Einordnung, wo die Grenze der Nutzbarkeit von Big Data auf normalen Laptop/PC-Systemen grob liegt: im <strong>GByte-Bereich</strong>. Wer “richtig” Big Data macht, bewegt sich eher im Terabyte-Bereich (1 TByte = 1.024 GByte) oder gar im Petabyte-Bereich (1 PByte = 1.024 TByte = 1.048.576 GigaByte).</p>
<hr />
<div id="kurzer-gedanke-zur-datendichte" class="section level2">
<h2>Kurzer Gedanke zur Datendichte</h2>
<p>Als<code>Datendichte</code> bezeichne ich den theoretischen Wert aus dem <strong>Verhältnis von Information und Overhead</strong>. Die Information ist der konkrete Datenwert, der Overhead ist alles andere, was Platz belegt (Metadaten, Trennzeichen). Hier ein rudimentäres Beispiel:</p>
<p><strong>CSV-Datei</strong></p>
<p><code>ID;Jahr;Alter;Religion;Anzahl</code><br />
<code>1;2018;35;2;500</code></p>
<p>Die reine Information ist <code>2018</code>, <code>35</code>, <code>2</code> und <code>500</code>. Alle anderen Zeichen sind in diesem Sinne der Overhead.</p>
<p>Betrachten wir mit diesem Beispiel einige andere typische Datenformate und deren Overhead:</p>
<p><strong>YAML-Datei</strong> (“YAML Ain’t Markup Language”)</p>
<p><code>---</code><br />
<code>ID: 1</code><br />
<code>Jahr: 2018</code><br />
<code>Alter: 35</code><br />
<code>Religion: 2</code><br />
<code>Anzahl: 500</code></p>
<p><strong>JSON-Datei</strong> (“JavaScript Object Notation”)</p>
<p><code>{</code><br />
<code>"ID": 1,</code><br />
<code>"Jahr": "2018",</code><br />
<code>"Alter": 35,</code><br />
<code>"Religion": 2,</code><br />
<code>"Anzahl": 500</code><br />
<code>}</code></p>
<p><strong>XML-Datei</strong> (“Extensible Markup Language”)</p>
<p><code>&lt;ID&gt;1&lt;/ID&gt;</code><br />
<code>&lt;Jahr&gt;2018&lt;/Jahr&gt;</code><br />
<code>&lt;Alter&gt;35&lt;/Alter&gt;</code><br />
<code>&lt;Religion&gt;2&lt;/Religion&gt;</code><br />
<code>&lt;Anzahl&gt;500&lt;/Anzahl&gt;</code></p>
<ul>
<li>CSV: 44 Zeichen mit Kopfzeile, 15 Zeichen ohne Kopfzeile</li>
<li>YAML: 49 Zeichen</li>
<li>JSON: 64 Zeichen</li>
<li>XML: 90 Zeichen</li>
</ul>
<p>Die Liste ist nach zunehmender Zeichenanzahl bei gleichem Informationsinhalt, also nach abnehmender <em>Datendichte</em> sortiert. Es ist daraus zu schließen, dass <em>auf Zeichenebene</em> im Beispiel das CSV-Format im Vergleich zum XML-Format nur ein Siebtel des Platzes bei gleichem Informationsinhalt benötigt (die Kopfzeile ist nur einmal deklariert und daher vernachlässigbar).</p>
<p>Natürlich greift dieser Vergleich sehr kurz; die Vorteile und Anwendungsmöglichkeiten der jeweiligen Datenformate ist hier nicht das Thema. Für meine Zwecke zählt an dieser Stelle nur, dass die verwendeten Eingangsdaten in CSV bei begrenzten Ressourcen ein Maximum an Datendichte bzw. an Informationsmenge beinhalten.</p>
<hr />
</div>
<div id="r-base-vs.-tidyverse" class="section level2">
<h2>R Base vs. Tidyverse</h2>
<p>Ich vergleiche drei Methoden miteinander:</p>
<ul>
<li>die R Base-Methode <code>read.csv</code>,</li>
<li>die optimierte Methode <code>read_csv</code> aus der <code>Tidyverse</code>-Paketsammlung mit der optimierten <code>map_df</code>-Funktion des sogenannten <em>functional programming toolkits</em> <code>purrr</code>, und</li>
<li>die gleiche optimierte Methode, aber mit direkter Anwendung der <code>bind_rows</code>-Funktion (die auch von <code>map_df</code> genutzt wird)</li>
</ul>
<p>Alle drei Methoden können komprimmierte Rohdaten (z. B. “.zip” oder “.bz2”) direkt entpacken und einlesen. Leider ist das kein unerheblicher Aufwand, der eine Menge Laufzeit frisst. Es läge also nahe, die Dekompression vorzulagern, was wiederum hinsichtlich Reproduzierbarkeit nachteilig ist. Ich vergleiche darum alle Methoden mit und ohne Dekompression, zeige aber nur den kompakteren und reproduzierbaren Code mit der komprimierten Variante der Rohdaten.</p>
<p>Die nach <code>test_import</code> importierten Daten müssen nach jedem Vorgang mit <code>rm()</code> gelöscht werden, um den RAM frei zu machen. Alle Variablen werden auf den Datentyp <code>character</code> fixiert. Das erfordert den minimalen Importaufwand, weil die Daten nicht umformatiert werden müssen. Ohne diesen Schritt würden <em>alle</em> Methoden aufgrund der Datenmenge beim “Rowbinding” mit Fehlern abbrechen.</p>
<p>Die Laufzeit wird wie üblich mit der Funktion <code>system.time</code> unter Einsatz eines einfachen Zählers <code>x</code> gemessen. Der gekapselte Code dazwischen ist sozusagen der Prozess, dessen Laufzeit gemessen wird.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">system.time</span>({</a>
<a class="sourceLine" id="cb2-2" title="2">  test_import &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="dt">path =</span> <span class="st">&quot;daten&quot;</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="st">    </span><span class="kw">lapply</span>(read.csv, <span class="dt">colClasses =</span> <span class="st">&quot;character&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="st">    </span>bind_rows</a>
<a class="sourceLine" id="cb2-5" title="5">  x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">100000</span></a>
<a class="sourceLine" id="cb2-6" title="6">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(x))  x[i] &lt;-<span class="st"> </span>x[i]<span class="op">+</span><span class="dv">1</span></a>
<a class="sourceLine" id="cb2-7" title="7">  })</a>
<a class="sourceLine" id="cb2-8" title="8"></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="kw">rm</span>(test_import)</a></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">import_func &lt;-<span class="st"> </span><span class="cf">function</span>(dat) {</a>
<a class="sourceLine" id="cb3-2" title="2">    <span class="kw">read_csv</span>(dat, <span class="dt">col_types =</span> <span class="kw">cols</span>(<span class="dt">.default =</span> <span class="kw">col_character</span>()))</a>
<a class="sourceLine" id="cb3-3" title="3">}</a>
<a class="sourceLine" id="cb3-4" title="4"></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="kw">system.time</span>({</a>
<a class="sourceLine" id="cb3-6" title="6">  test_import &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="st">&quot;daten&quot;</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-7" title="7"><span class="st">                </span><span class="kw">map_df</span>(<span class="op">~</span><span class="kw">import_func</span>(.))</a>
<a class="sourceLine" id="cb3-8" title="8">  x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">100000</span></a>
<a class="sourceLine" id="cb3-9" title="9">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(x))  x[i] &lt;-<span class="st"> </span>x[i]<span class="op">+</span><span class="dv">1</span></a>
<a class="sourceLine" id="cb3-10" title="10">  })</a>
<a class="sourceLine" id="cb3-11" title="11"></a>
<a class="sourceLine" id="cb3-12" title="12"><span class="kw">rm</span>(test_import)</a></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">system.time</span>({</a>
<a class="sourceLine" id="cb4-2" title="2">  test_import &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="dt">path =</span> <span class="st">&quot;daten&quot;</span>, <span class="dt">full.names =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="st">    </span><span class="kw">lapply</span>(read_csv, <span class="dt">col_types =</span> <span class="kw">cols</span>(<span class="dt">.default =</span> <span class="kw">col_character</span>())) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="st">    </span>bind_rows</a>
<a class="sourceLine" id="cb4-5" title="5">  x &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">100000</span></a>
<a class="sourceLine" id="cb4-6" title="6">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="kw">seq_along</span>(x))  x[i] &lt;-<span class="st"> </span>x[i]<span class="op">+</span><span class="dv">1</span></a>
<a class="sourceLine" id="cb4-7" title="7">  })</a>
<a class="sourceLine" id="cb4-8" title="8"></a>
<a class="sourceLine" id="cb4-9" title="9"><span class="kw">dim</span>(test_import)</a></code></pre></div>
<hr />
</div>
</div>
<div id="testergebnisse" class="section level1">
<h1>Testergebnisse</h1>
<p>Es werden in jedem Importprozess 42.363.271 Datenzeilen mit je 29 Variablen, also insgesamt <strong>1.228.534.859 (~ 1,2 Mrd.) Werte</strong> eingelesen. Die Speicherauslastung kommt dabei auf jeweils über 95 % bei 16 GByte RAM. Die Spitze wird nach dem Einlesen im Prozess des “Rowbindings” erreicht. In dem genutzten technischen Setting bilden die sechs genutzten Dateien die physikalische Grenze der verarbeitbaren Datenmenge. Die Ergebnisse der Laufzeitmessung sind wie folgt:</p>
<table>
<thead>
<tr class="header">
<th>Methode</th>
<th>komprimiert (ja/nein)</th>
<th>Laufzeit (sek)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>read.csv</td>
<td>ja</td>
<td>1011</td>
</tr>
<tr class="even">
<td>read_csv mit map_df</td>
<td>ja</td>
<td>511</td>
</tr>
<tr class="odd">
<td>read_csv mit bind_rows</td>
<td>ja</td>
<td>491</td>
</tr>
<tr class="even">
<td>read.csv</td>
<td>nein</td>
<td>383</td>
</tr>
<tr class="odd">
<td>read_csv mit map_df</td>
<td>nein</td>
<td>211</td>
</tr>
<tr class="even">
<td>read_csv mit bind_rows</td>
<td>nein</td>
<td>205</td>
</tr>
</tbody>
</table>
<p>Anschließend möchte ich testen, wie R mit diesem <em>Riesen-Tibble</em> umgehen kann. Ich stelle eine einfache Auswertung in der folgenden Tabelle dar. Das Tibble wird hierfür nach <code>Year</code> gruppiert und anschließend nach zwei Merkmalen ausgewertet: die Anzahl der eingesetzten Flugzeuge nach eindeutiger Tail Number <code>n_distinct(TailNum)</code> sowie die jährliche Gesamtzahl der Flüge <code>n()</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">knitr<span class="op">::</span><span class="kw">kable</span>(</a>
<a class="sourceLine" id="cb5-2" title="2">  test_import <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="st">    </span><span class="kw">group_by</span>(Year) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="st">    </span><span class="kw">summarize</span>(<span class="kw">n_distinct</span>(TailNum), <span class="kw">n</span>()), </a>
<a class="sourceLine" id="cb5-5" title="5">  <span class="dt">format.args =</span> <span class="kw">list</span>(<span class="dt">decimal.mark =</span> <span class="st">&quot;,&quot;</span>, <span class="dt">big.mark =</span> <span class="st">&quot;.&quot;</span>), </a>
<a class="sourceLine" id="cb5-6" title="6">  <span class="dt">caption =</span> <span class="st">&quot;Zusammenfassung der Anzahl der eingesetzten Flugzeuge nach eindeutiger Tail Number sowie jährliche Gesamtzahl der Flüge&quot;)</span></a></code></pre></div>
<hr />
</div>
<div id="fazit" class="section level1">
<h1>Fazit</h1>
<p>Mit einem cleveren Management von Im-/Export und den geeigneten Methoden/R-Paketen können auch mit R-Desktop Big Data-Probleme in einer begrenzten Größenordnung angegangen werden. Je größer die Datenmenge, desto wichtiger ist das genutzte Datenformat hinsichtlich Dateigröße und Parsing-Aufwand. Auf einen Formatvergleich in der Verarbeitung habe ich hier verzichtet. Vielleicht teste ich das später einmal aus.</p>
<p>Die optimierte Methode <code>read_csv</code> ist gegenüber der Basismethode <code>read.csv</code> weitaus effizienter. Der CSV-Import läuft in fast der doppelten Geschwindigkeit ab. Kommt der Dekomprimierungsprozess beim Import hinzu, läuft die optimierte Variante sogar mehr als doppelt so schnell. Der “funktionalere Ansatz” mit <code>map_df</code> ist gegenüber <code>lapply</code> / <code>bind_rows</code> leicht unterlegen, aber vergleichbar effizient.</p>
<p>Sind die Daten erst einmal als Tibble eingelesen, laufen einfache Analysefunktionen (z. B. <code>n()</code> oder <code>sum()</code>) und Gruppierungen mit <code>group_by()</code> erstaunlich effizient ab. Es spielt hier keine spürbare Rolle, wie groß der betrachtete Datensatz ist. Mit der Weiterverarbeitung von “Big Data mit R Desktop” will ich mich später bei Gelegenheit vertiefend beschäftigen…</p>
</div>
<div id="anhang-build-with" class="section level1">
<h1>Anhang: Build with</h1>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">sessionInfo</span>()</a></code></pre></div>
<pre><code>## R version 3.6.0 (2019-04-26)
## Platform: x86_64-pc-linux-gnu (64-bit)
## Running under: Manjaro Linux
## 
## Matrix products: default
## BLAS:   /usr/lib/libopenblasp-r0.3.6.so
## LAPACK: /usr/lib/liblapack.so.3.8.0
## 
## Random number generation:
##  RNG:     Mersenne-Twister 
##  Normal:  Inversion 
##  Sample:  Rounding 
##  
## locale:
##  [1] LC_CTYPE=de_DE.UTF-8       LC_NUMERIC=C              
##  [3] LC_TIME=de_DE.UTF-8        LC_COLLATE=de_DE.UTF-8    
##  [5] LC_MONETARY=de_DE.UTF-8    LC_MESSAGES=de_DE.UTF-8   
##  [7] LC_PAPER=de_DE.UTF-8       LC_NAME=C                 
##  [9] LC_ADDRESS=C               LC_TELEPHONE=C            
## [11] LC_MEASUREMENT=de_DE.UTF-8 LC_IDENTIFICATION=C       
## 
## attached base packages:
## [1] stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] lubridate_1.7.4    highcharter_0.7.0  kableExtra_1.1.0  
##  [4] DT_0.6             stopwords_0.9.0    tidytext_0.2.0    
##  [7] ggthemes_4.2.0     svglite_1.2.2      wordcloud_2.6     
## [10] RColorBrewer_1.1-2 forcats_0.4.0      stringr_1.4.0     
## [13] dplyr_0.8.1        purrr_0.3.2        readr_1.3.1       
## [16] tidyr_0.8.3        tibble_2.1.2       ggplot2_3.1.1     
## [19] tidyverse_1.2.1   
## 
## loaded via a namespace (and not attached):
##  [1] nlme_3.1-140      xts_0.11-2        webshot_0.5.1    
##  [4] httr_1.4.0        SnowballC_0.6.0   tools_3.6.0      
##  [7] backports_1.1.4   utf8_1.1.4        R6_2.4.0         
## [10] lazyeval_0.2.2    colorspace_1.4-1  withr_2.1.2      
## [13] tidyselect_0.2.5  curl_3.3          compiler_3.6.0   
## [16] cli_1.1.0         rvest_0.3.4       xml2_1.2.0       
## [19] labeling_0.3      scales_1.0.0      digest_0.6.19    
## [22] rmarkdown_1.13    pkgconfig_2.0.2   htmltools_0.3.6  
## [25] highr_0.8         htmlwidgets_1.3   rlang_0.3.4      
## [28] readxl_1.3.1      TTR_0.23-4        rstudioapi_0.10  
## [31] quantmod_0.4-14   shiny_1.3.2       generics_0.0.2   
## [34] zoo_1.8-6         jsonlite_1.6      crosstalk_1.0.0  
## [37] tokenizers_0.2.1  magrittr_1.5      rlist_0.4.6.1    
## [40] Matrix_1.2-17     Rcpp_1.0.1        munsell_0.5.0    
## [43] fansi_0.4.0       gdtools_0.1.8     stringi_1.4.3    
## [46] whisker_0.3-2     yaml_2.2.0        plyr_1.8.4       
## [49] grid_3.6.0        promises_1.0.1    crayon_1.3.4     
## [52] lattice_0.20-38   haven_2.1.0       hms_0.4.2        
## [55] zeallot_0.1.0     knitr_1.23        pillar_1.4.1     
## [58] igraph_1.2.4.1    reshape2_1.4.3    glue_1.3.1       
## [61] evaluate_0.14     data.table_1.12.2 modelr_0.1.4     
## [64] httpuv_1.5.1      vctrs_0.1.0       cellranger_1.1.0 
## [67] gtable_0.3.0      assertthat_0.2.1  xfun_0.7         
## [70] mime_0.6          tufte_0.5         xtable_1.8-4     
## [73] broom_0.5.2       later_0.8.0       janeaustenr_0.1.5
## [76] viridisLite_0.3.0</code></pre>
</div>

<p><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png" /></a><br />Dieses Werk ist lizenziert unter einer <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</p>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
